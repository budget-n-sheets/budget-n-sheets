<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <?!= htmlInclude("gas-common/htmlStyles"); ?>
</head>

<body>
  <form accept-charset="UTF-8" id="the_form" onsubmit="submitForm();">
    <table style="width: 100%;">
      <tr>
        <td>
          <input id="pass" type="password" placeholder="Passphrase" style="width: 100%;" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');" required>
        </td>
      </tr>
    </table>
    <input id="file_id" style="display: none;" type="text" value="<?= file_id ?>" required>
  </form>

  <div>
    <span class="error" id="warn"></span>
  </div>
  <div>
    <button class="action" id="b-Ok" type="submit" form="the_form">Ok</button>
    <button onclick="google.script.host.close()">Cancel</button>
  </div>

  <?!= htmlInclude("gas-common/htmlJavaScript"); ?>
  <script>
    function submitForm() {
      $('#warn').empty();
      $('button').prop('disabled', true);

      google.script.run
        .withSuccessHandler(submitAftermath)
        .withFailureHandler(showError)
        .requestDevelopBackup($('#file_id').val(), $('#pass').val());
    }

    function submitAftermath(r) {
      if (r === 3) $('#warn').empty().append('Something went wrong. Try again later.');
      else if (r === 2) $('#warn').empty().append('Invalid passphrase.');
      else if (r === 1) google.script.host.close();
      $('button').prop('disabled', false);
    }
  </script>
</body>

</html>
