<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <?!= htmlInclude("gas-common/htmlStyles"); ?>
  <style>
    p {
      text-indent: 0;
    }

    table {
      width: 100%;
    }

    td.border {
      border-bottom: none;
    }

    #content {
      padding: 7px 5px;
    }
  </style>
</head>

<body>
  <div id="wrapper">
    <div id="content">
      <div class="panel active" id="restore-panel">
        <table>
          <tr>
            <th colspan="2"><span style="font-size: 1.2em;"><span class="material-icons-outlined">table_chart</span> Spreadsheet</span></th>
          </tr>
          <tr>
            <td class="name" style="width: 127px;">Spreadsheet name</td>
            <td id="file_name">
            </td>
          </tr>
          <tr>
            <td class="border name">Last modified</td>
            <td class="border" id="last_updated">
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <span class="error" id="response"></span>
              <div>
                <button class="action" id="b-Select">Select spreadsheet</button>
                <button onclick="google.script.host.close()">Cancel</button>
              </div>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <script src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
  <?!= htmlInclude("gas-common/htmlJavaScript"); ?>
  <script>
    const FILE_ID = <?= fileId ?>;

    $(document).ready(function() {
      $('#b-Select').click(pickFile);
      <? if (hasFileId) { ?>
      $('#b-Select').prop('disabled', true);

      google.script.run
        .withFailureHandler(showError)
        .withSuccessHandler(refreshInfo)
        .validateSpreadsheet(FILE_ID);
      <? } ?>
    });

    function refreshInfo (info) {
      $("#response").empty();
      $('#b-Select').prop('disabled', false);

      if (info === 1) {
        $("#response").append('Sorry, something went wrong. Try again in a moment.');
        return;
      } else if (info === 2) {
        $("#response").append('No spreadsheet with the given ID could be found, or you do not have permission to access it.');
        return;
      } else if (info === 3) {
        $("#response").append('Sorry, it was not possible to verify the spreadsheet.');
        return;
      }
    }

    function pickFile() {
      this.disabled = true;
      google.script.run
        .withFailureHandler(showError)
        .withSuccessHandler(function() {
          google.script.host.close();
        })
        .showDialogPickerRestore('copy');
    }
  </script>
</body>

</html>
