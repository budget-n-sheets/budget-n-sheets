<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <?!= htmlInclude("gas-common/htmlStyles"); ?>
  <style>
    p {
      text-indent: 0;
    }

    table {
      width: 100%;
    }

    td.border {
      border-bottom: none;
    }
  </style>
</head>

<body>
  <table>
    <tr>
      <th colspan="2"><span style="font-size: 1.2em;"><span class="material-icons-outlined">restore</span> Backup file</span></th>
    </tr>
    <tr>
      <td class="name" style="width: 127px;">File name</td>
      <td id="file_name">
      </td>
    </tr>
    <tr>
      <td class="border name">Date created</td>
      <td class="border" id="date_created">
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <span class="error" id="response1"></span>
        <div>
          <button class="action" id="b-Select">Select</button>
          <button onclick="google.script.host.close()">Cancel</button>
        </div>
      </td>
    </tr>
  </table>

  <div class="panel">
    <p>Your budget spreadsheet will contain the following settings:</p>
    <table style="margin-top: 1.3em;">
      <tr>
        <th colspan="2"><span style="font-size: 1.2em;"><span class="material-icons-outlined">table_chart</span> Spreadsheet</span></th>
      </tr>
      <tr>
        <td class="name" style="width: 127px;">Spreadsheet title</td>
        <td id="spreadsheet_title"></td>
      </tr>
      <tr>
        <td class="name">Financial year</td>
        <td id="financial_year"></td>
      </tr>
      <tr>
        <td class="name">Initial month</td>
        <td id="initial_month"></td>
      </tr>
      <tr>
        <td class="name">Financial calendar</td>
        <td id="financial_calendar"></td>
      </tr>
    </table>

    <table style="margin-top: 1.3em;">
      <tr>
        <th colspan="2"><span style="font-size: 1.2em;"><span class="material-icons-outlined">assignment</span> Accounts, cards, and tags</span></th>
      </tr>
      <tr>
        <td class="name" style="width: 127px;">Accounts</td>
        <td id="accounts"></td>
      </tr>
      <tr>
        <td class="name">Cards</td>
        <td id="cards"></td>
      </tr>
      <tr>
        <td class="name">Tags</td>
        <td id="tags"></td>
      </tr>
    </table>
  </div>

  <script src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
  <?!= htmlInclude("gas-common/htmlJavaScript"); ?>
  <script>
    var fileId = <?= fileId ?>;

    $(document).ready(function() {
      $('#b-Select').click(pickFile);
      <? if (hasFileId) { ?>
      $('#b-Select').prop('disabled', true);

      google.script.run
        .withFailureHandler(showError)
        .withSuccessHandler(refreshInfo)
        .validateBackup(fileId);
      <? }?>
    });

    function refreshInfo (info) {
      $("#response").empty();
      $('#b-Select').prop('disabled', false);

      if (info === 1) {
        $("#response1").append('Sorry, something went wrong. Try again in a moment.');
        return;
      } else if (info === 2) {
        $("#response1").append('No file with the given ID could be found. Possibly because you have not edited this file or you do not have permission to access it.');
        return;
      } else if (info === 3) {
        $("#response1").append('The file is either not a supported file type or the file is corrupted.');
        return;
      }

      for (var key in info) {
        $("#" + key).append(info[key]);
      }

      $('.panel').fadeIn('fast');
    }

    function pickFile () {
      this.disabled = true;
      google.script.run
        .withFailureHandler(showError)
        .withSuccessHandler(function () {
            google.script.host.close();
          })
        .showDialogPickerRestore();
    }
  </script>
</body>

</html>
