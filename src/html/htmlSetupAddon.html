<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude("gas-common/htmlStyles"); ?>
		<style>
			table {
				width: 100%;
			}

			.wait_load-wrapper {
				width: 190px;
			}
			.wait_load-bar {
				width: 113px;
				animation-name: animateCustomProgressBar;
				animation-duration: 1493ms;
			}
			@keyframes animateCustomProgressBar {
				from {left: -257px;}
				to {left: 257px;}
			}

			.fancy_box {
				width: 263px;
				height: 41px;
				margin-top: 41px;
				padding: 11px 19px;
				font-size: 17px;
				border: 1px solid #cccccc;
				border-left: none;
				border-right: none;
				position: relative;
				overflow: hidden;
			}
			.fancy_box div {
				width: 300px;
				left: 300px;
				position: absolute;
				word-wrap: break-word;
				animation-name: slidein;
				animation-duration: 48s;
				animation-iteration-count: infinite;
			}

			@keyframes slidein {
				from { left: 400px; }
				1.04% { left: 0px; }
				23.92% { left: 0px; }
				24.96% { left: -400px; }
				to { left: -400px; }
			}

			.fancy_box div:nth-child(1) { animation-delay: 0s; }
			.fancy_box div:nth-child(2) { animation-delay: 12s; }
			.fancy_box div:nth-child(3) { animation-delay: 24s; }
			.fancy_box div:nth-child(4) { animation-delay: 36s; }

			#content {
				padding: 7px 5px;
				margin-bottom: 4.7em;
			}
		</style>
	</head>
	<body>
		<div id="wrapper">
			<div id="content">
				<div class="panel" id="main-panel" align="center">
					<img style="height:83px;margin:1.7em 0 0 0;" src="https://raw.githubusercontent.com/guimspace/budget-n-sheets/master/media/icon/icon-large.png" alt="Budget n Sheets">
					<h2 style="margin-bottom:0.3em;">Budget n Sheets</h2>
					<span class="gray" style="font-style:italic;">Mind your budget</span>
					<div style="margin-top:2.3em;">
						<button class="action" style="width:13em;" onclick="clickNext()">Start</button>
					</div>
					<div style="margin-top:0.7em;">
						<a href="https://sites.google.com/view/guimspace/budget-n-sheets/privacy-policy" target="_blank">Privacy Policy</a> and <a href="https://sites.google.com/view/guimspace/budget-n-sheets/terms-of-service" target="_blank">Terms of Service</a>
					</div>
				</div>

				<div class="panel" id="note-panel">
					<h2>Attention</h2>
					<p>All sheets and data of the spreadsheet will be deleted before the building process start!</p>
					<p>If the spreadsheet has important or sensitive data that you care about, <a href="https://support.google.com/docs/answer/49114" target="_blank"><b>make a copy or start a new spreadsheet</b></a> before continuing, then restart the building process.</p>
				</div>

				<div class="panel" id="form-panel">
					<div style="display:table;width:100%;">
						<div style="display:table-row;">
							<div style="width:100%;display:table-cell;vertical-align:middle;">
								<h2>Spreadsheet specs</h2>
							</div>
							<div align="right" style="display:table-cell;vertical-align:middle;">
								<a id="i-help" href="https://github.com/guimspace/budget-n-sheets/wiki" target="_blank"><i class="material-icons md-click md-18">help</i></a>
							</div>
						</div>
					</div>

					<form accept-charset="UTF-8">
						<table style="width: 100%;">
							<tr>
								<td class="name" style="width:50%;"><label for="spreadsheet_name">Spreadsheet title</label></td>
								<td><input type="text" id="spreadsheet_name" maxlength="53" required></td>
							</tr>
						</table>
						<table style="width: 100%; margin-top: 2em;">
							<tr>
								<th colspan="2" style="font-size:1.2em;"><i class="material-icons">calendar_today</i> Calendar</th>
							</tr>
							<tr>
								<td class="name" style="width:50%;"><label for="financial_year">Financial year</label></td>
								<td><input type="number" id="financial_year" style="width:61px;" min="1889" max="2111" step="1" required></td>
							</tr>
							<tr>
								<td class="name" style="width:50%;"><label for="initial_month">Initial month</label></td>
								<td>
									<select id="initial_month" style="width:89px;">
										<option value="0" selected>January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5">June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</td>
							</tr>
						</table>
						<table style="width: 100%; margin-top: 2em;">
							<tr>
								<th colspan="2" style="font-size:1.2em;"><i class="material-icons">account_balance</i> Accounts</th>
							</tr>
							<tr>
								<td class="name comment" style="width:50%;"><label for="number_accounts">Accounts</label></td>
								<td>
									<select id="number_accounts" style="width:83px;">
										<option value="1" selected>One</option>
										<option value="2">Two</option>
										<option value="3">Three</option>
										<option value="4">Four</option>
										<option value="5">Five</option>
									</select>
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 1</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" name="account_name" style="width: 100%;" required>
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 2</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" name="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 3</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" name="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 4</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" name="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 5</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" name="account_name" style="width: 100%;">
								</td>
							</tr>
						</table>
					</form>
				</div>

				<div class="panel" id="setup-panel">
					<div style="width:100%;margin:40px auto 0 auto;" align="center">
						<h2>Assembling your spreadsheet</h2>
						<br>
						<div class="wait_load-wrapper">
							<div class="wait_load-bar"></div>
						</div>
						<div style="width:263px;margin-top:19px;">
							This process takes up to two minutes. Do not edit the spreadsheet until it is finished.
						</div>
						<div id="the_box">
							<div>Join the <a href="https://groups.google.com/d/forum/add-on-budget-n-sheets-forum" target="_blank"><b>forum</b></a> to post questions and discussions.</div>
							<div>Visit the <a href="https://github.com/guimspace/budget-n-sheets/wiki" target="_blank"><b>wiki</b></a> for a full review of the features.</div>
							<div>Send valuable <a href="https://forms.gle/sVzBD4345hWh5gYB8" target="_blank">feedback</a>. <a href="https://gsuite.google.com/marketplace/app/budget_n_sheets/628594713587" target="_blank">Rate</a> the add-on.</div>
							<div>Budget n Sheets is free, ad-free and open source.</div>
						</div>
					</div>
					<div id="timeout" style="display: none;margin-top: 2em;">
						It is taking too long. You can try again or <a href="https://forms.gle/sVzBD4345hWh5gYB8" target="_blank">report a problem</a>.
					</div>
				</div>
			</div>

			<div id="footer" style="display:table;">
				<div style="display:table-row;">
					<div id="footer-buttons" style="height:3.7em;display:table-cell;padding:7px;vertical-align:middle;">
					</div>
				</div>
			</div>
		</div>
		<?!= htmlInclude("gas-common/htmlJavaScript"); ?>
		<script>
			$(document).ready(function() {
				var date = new Date();
				$("#financial_year").val(date.getFullYear());
				if (date.getMonth() > 1) {
					$("#initial_month").val(date.getMonth() - 1);
				}

				$(".num_acc").slice(1).hide();
				$("#main-panel").fadeIn().addClass("active");
			});

			$("#number_accounts").change(function() {
				var num_acc = Number( $(this).val() );

				$(".num_acc").show();
				$(".num_acc").slice(num_acc).hide();

				$("input[name=account_name]").attr("required", true);
				$("input[name=account_name]").slice(num_acc).attr("required", false).val("");
			});

			function clickNext() {
				window.scrollTo(0, 0);

				var p = $(".active").attr("id");
				$("#" + p).removeClass("active");

				$(".panel").hide();
				$("#footer-buttons button").remove();

				switch (p) {
				case "main-panel":
					$("#note-panel").fadeIn("fast").addClass("active");
					$("#footer-buttons").append("<button class=\"action\" onclick=\"clickNext()\">Continue</button>");
					break;
				case "note-panel":
					$("#form-panel").fadeIn("fast").addClass("active");
					$("#footer-buttons").append("<button class=\"create\" onclick=\"clickNext()\">Build</button>");
					break;
				case "form-panel":
					$("#setup-panel").fadeIn("fast").addClass("active");
					$("#the_box").addClass("fancy_box");
					fireSetup();
					break;
				default:
					break;
				}
			}

			function fireSetup() {
				var settings = {
					spreadsheet_name: $("#spreadsheet_name").val(),
					financial_year: $("#financial_year").val(),
					initial_month: $("#initial_month").val(),
					number_accounts: $("#number_accounts").val()
				};

				var list_names = [ ];

				$(":input[required][name=account_name]").each(function(i) {
					list_names[i] = $(this).val();
				});

				setTimeout(function() {
						google.script.host.setHeight(397);
						$("#timeout").fadeIn();
						$("#footer-buttons").append("<button onclick=\"google.script.host.close()\">Close</button>");
					}, 120000);

				google.script.run
					.withSuccessHandler(function() {
							google.script.host.close();
						})
					.withFailureHandler(showError)
					.setup_ui(settings, list_names);
			}
		</script>
	</body>
</html>
