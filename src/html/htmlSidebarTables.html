<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude("gas-common/htmlStyles"); ?>
		<style>
			#header {
				height: 3.7em;
				width: 100%;
				background-color: #efefef;
				border-bottom: 2px solid #d9d9d9;
			}

			.header_table {
				display: table;
				width: inherit;
				height: inherit;
				border-collapse: separate;
				border-spacing: 13px 7px;
			}
			.header_tab {
				cursor: pointer;
				display: table-cell;
				vertical-align:middle;
				color: #7a7a7a;
				font-size: 24px;
			}

			.footer_table {
				background-color: #efefef;
				width: 100%;
				display: table;
				border-collapse: separate;
				border-spacing: 7px;
				border-top: 2px solid #d9d9d9;
			}
			.footer_cell {
				display: table-cell;
				vertical-align: middle;
			}

			.item_table {
				width: 100%;
				margin-bottom: 17px;
				display: table;
				border: 1px solid #d9d9d9;
				border-radius: 7px;
			}
			.item_cell {
				width: 100%;
				padding: 11px;
				display: table-cell;
			}

			.item_menu {
				font-weight: bold;
				word-spacing: 11px;
			}

			.table_row {
				display: table-row;
			}

			#tab_accounts { color: #b6d7a8; }
			#tab_accounts:hover { color: #6aa84f; }
			#tab_accounts.active { color: #6aa84f; border-bottom: solid 2px; }

			#tab_cards { color: #a4c2f4; }
			#tab_cards:hover { color: #3c78d8; }
			#tab_cards.active { color: #3c78d8; border-bottom: solid 2px; }
		</style>
	</head>
	<body>
		<div id="wrapper">
			<div id="header" align="center">
				<div class="header_table">
					<div class="table_row">
						<div class="header_tab <?= tab_acc ?>" id="tab_accounts">
							<i class="material-icons" title="Accounts">account_balance</i>
						</div>
						<div class="header_tab <?= tab_cards ?>" id="tab_cards">
							<i class="material-icons" title="Cards">credit_card</i>
						</div>
					</div>
				</div>
			</div>

			<div id="content" style="margin-bottom:4.7em;">
				<div class="panel <?= tab_acc ?>" id="panel_Accounts">
					<div id="box_Accounts">
					</div>
				</div>

				<div class="panel <?= tab_cards ?>" id="panel_Cards">
					<div id="box_Cards">
					</div>

					<div class="item_table" id="item-AddCard" style="display: none;border: 1px dashed #d9d9d9;">
						<div class="table_row">
							<div class="item_cell" style="height: 2.3em;vertical-align: middle;">
								<a id="b-AddCard"><i class="material-icons">add</i> Add card</a>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div id="footer">
				<div class="current" id="response" style="padding:0 7px;"></div>
				<div class="footer_table">
					<div class="table_row">
						<div class="footer_cell" style="width:100%;">
						</div>
						<div class="footer_cell">
							<a id="i-help" href="https://github.com/guimspace/budget-n-sheets/wiki" target="_blank"><i class="material-icons md-click md-18">help</i></a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<?!= htmlInclude("gas-common/htmlJavaScript"); ?>
		<script>
			$(document).ready(function() {
				$("#b-AddCard").click(function(e) {
					$("#response").empty();
					google.script.run
						.withFailureHandler(showError)
						.showDialogAddCard();
				});

				google.script.run
					.withSuccessHandler(listAccounts)
					.withFailureHandler(showError)
					.tablesService("get", "accounts");

				google.script.run
					.withSuccessHandler(listCards)
					.withFailureHandler(showError)
					.tablesService("get", "cards");
			});

			$(document).on("click", ".header_tab", function() {
				if ($(this).hasClass("active")) return;

				$(this).addClass("active")
					.siblings()
					.removeClass("active");

				window.scrollTo(0, 0);
				if ($(this).attr("id") === "tab_accounts") {
					$("#panel_Accounts").fadeIn("fast")
						.siblings()
						.hide();
				} else if ($(this).attr("id") === "tab_cards") {
					$("#panel_Cards").fadeIn("fast")
						.siblings()
						.hide();
				}
			});

			$(document).on("click", ".a-edit", function(e) {
				$("#response").empty();
				google.script.run
					.withFailureHandler(showError)
					.showDialogEditAccount($(this).attr("id"));
			});

			$(document).on("click", ".c-edit", function(e) {
				$("#response").empty();
				google.script.run
					.withFailureHandler(showError)
					.showDialogEditCard($(this).parent().attr("id"));
			});

			$(document).on("click", ".c-remove", function(e) {
				var response = confirm("Click OK to confirm and remove the card.");
				if (!response) return;
				google.script.run
					.withSuccessHandler(reloadListCards)
					.withFailureHandler(showError)
					.tablesService("set", "deletecard", $(this).parent().attr("id"));
			});

			function reloadListCards() {
				$("#item-AddCard").hide();
				$("#box_Cards").empty();

				google.script.run
					.withSuccessHandler(listCards)
					.withFailureHandler(showError)
					.tablesService("get", "cards");
			}

			function listAccounts(db_accounts) {
				var item, k;

				for (k = 0; k < db_accounts.length; k++) {
					item = "<div class=\"table_row\">";
					item += "<div class=\"item_cell\" style=\"font-size: 23px;\">" + db_accounts[k].name + "</div>";
					item += "</div>"

					item += "<div class=\"table_row\">";
					item += "</div>";

					item += "<div class=\"table_row\">";
					item += "<div class=\"item_cell item_menu\">";
					item += "<a class=\"a-edit\" id=\"" + db_accounts[k].id + "\">Edit</a>";
					item += "</div>";
					item += "</div>";

					item = "<div class=\"item_table\">" + item + "</div>"
					$("#box_Accounts").append(item);
				}
			}

			function listCards(db_cards) {
				var item, k, n;

				n = 0;
				for (k = 0; k < db_cards.length; k++) {
					item = "<div class=\"table_row\">";
					item += "<div class=\"item_cell\" style=\"font-size: 23px;\">" + db_cards[k].name + "</div>";
					item += "</div>";

					item += "<div class=\"table_row\">";
					item += "<div class=\"item_cell item_menu\" id=\"" + db_cards[k].id + "\">";
					item += "<a class=\"c-edit\">Edit</a> ";
					item += "<a class=\"c-remove\">Remove</a>";
					item += "</div>";
					item += "</div>";

					item = "<div class=\"item_table\">" + item + "</div>"
					$("#box_Cards").append(item);
					n++;
				}

				if (n < 10) $("#item-AddCard").show();
			}
		</script>
	</body>
</html>
