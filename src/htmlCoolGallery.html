<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude('htmlStyles'); ?>
		<style>
			.table {
				display: table;
				width: 100%;
				margin-bottom: 17px;
				border: 1px solid #d9d9d9;
				border-radius: 7px;
			}
			.table_row {
				display: table-row;
			}
			.table_name {
				width: 100%;
				display: table-cell;
				padding: 11px;
			}
			.table_buttons {
				width: 100%;
				display: table-cell;
				padding: 11px;
				font-weight: bold;
				border-top: 1px solid #d9d9d9;
				word-spacing: 11px;
			}

			.MainMenu-bot_title {
				display: table;
				width: 100%;
				border-collapse: separate;
				border-spacing: 7px;
			}
			.MainMenu_row {
				display: table-row;
			}
			.m-footer {
				display: table-cell;
				vertical-align: middle;
			}
		</style>
	</head>
	<body>
		<div id="MainPanel_wrapper">

			<div id="MainPanel_content" style="margin-bottom:4.7em;">
				<div class="panel active" id="panel_List">
					<? for (var i in list) { ?>
					<div class="table">
						<div class="table_row">
							<div class="table_name">
								<span style="font-size: 23px;"><?= list[i].name ?></span><br>
								<span class="gray"><?= list[i].version_date ?></span><br>
								<span class="gray"><?= list[i].version_name ?></span>
							</div>
						</div>
						<div class="table_row">
							<div class="table_buttons">
								<a href="https://docs.google.com/spreadsheets/d/e/<?= list[i].preview_id ?>/pubhtml" target="_blank">Preview</a> <a class="m-la" id="<?= i ?>">Import</a>
							</div>
						</div>
					</div>
					<? } ?>
				</div>


				<div class="panel" id="panel_WaitLoad" align="center">
					<b>Importing now...</b><br>

					<div class="animation_WaitLoad_wrapper">
						<div class="animation_WaitLoad_bar"></div>
					</div>
				</div>
			</div>

			<div id="MainPanel_footer">
				<div class="MainMenu-bot_title"><div class="MainMenu_row">
					<div class="m-footer left"style="width: 100%;">
						<span class="current" id="p-Response"></span>
					</div>
					<div class="m-footer right">
						<a id="i-help" href="https://forms.gle/sVzBD4345hWh5gYB8" target="_blank"><i class="material-icons md-click md-24" title="Send feedback">feedback</i></a>
					</div>
				</div></div>
			</div>
		</div>

		<?!= htmlInclude('htmlJavaScript'); ?>
		<script>
			$(document).on('click', '.m-la', function() {
				var id = $(this).attr('id');

				$("#p-Response").empty();
				$('#panel_WaitLoad').fadeIn('fast')
					.siblings()
					.hide();
				google.script.run.withSuccessHandler(response)
					.withFailureHandler(showError)
					.coolGallery(id);
			});

			function response(r) {
				$('#panel_List').fadeIn('fast')
					.siblings()
					.hide();

				if (r === 0) {
					$("#p-Response").empty().append("Add-on is busy. Try again in a moment.");
				} else if (r === 1) {
					$("#p-Response").empty().append("Something went wrong. Try again in a moment.");
				} else if (r === 3) {
					showError();
				}
			}
		</script>
	</body>
</html>
