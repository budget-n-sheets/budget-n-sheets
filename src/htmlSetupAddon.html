<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude("htmlStyles"); ?>
		<style>
			table {
				width: 100%;
			}

			.animation_WaitLoad_wrapper {
				width: 190px;
			}
			.animation_WaitLoad_bar {
				width: 113px;
				animation-name: animateCustomProgressBar;
				animation-duration: 1493ms;
			}
			@keyframes animateCustomProgressBar {
				from {left: -257px;}
				to {left: 257px;}
			}

			#MainPanel_content {
				padding: 7px 5px;
				margin-bottom: 4.7em;
			}
		</style>
	</head>
	<body>
		<div id="MainPanel_wrapper">
			<div id="MainPanel_content">
				<div class="panel" id="main-panel" align="center">
					<img style="height:83px;margin:1.7em 0 0 0;" src="https://raw.githubusercontent.com/guimspace/budget-n-sheets/master/media/icon/icon-large.png" alt="Budget n Sheets">
					<h2 style="margin-bottom:0.3em;">Budget n Sheets</h2>
					<span class="gray" style="font-style:italic;">Mind your budget</span>
					<div style="margin-top:2.3em;">
						<button class="action" style="width:13em;" onclick="clickNext()">Start</button>
					</div>
					<div style="margin-top:0.7em;">
						<a href="https://sites.google.com/view/guimspace/budget-n-sheets/privacy-policy" target="_blank">Privacy Policy</a> and <a href="https://sites.google.com/view/guimspace/budget-n-sheets/terms-of-service" target="_blank">Terms of Service</a>
					</div>
				</div>

				<div class="panel" id="note-panel">
					<h2>Attention</h2>
					<p>All sheets and data of the spreadsheet will be deleted before the building process start!</p>
					<p>If the spreadsheet has important or sensitive data that you care about, <a href="https://support.google.com/docs/answer/49114" target="_blank"><b>make a copy or start a new spreadsheet</b></a> before continuing, then restart the building process.</p>
				</div>

				<div class="panel" id="form-panel">
					<div style="display:table;width:100%;">
						<div style="display:table-row;">
							<div style="width:100%;display:table-cell;vertical-align:middle;">
								<h2>Spreadsheet specs</h2>
							</div>
							<div align="right" style="display:table-cell;vertical-align:middle;">
								<a id="i-help" href="https://github.com/guimspace/budget-n-sheets/wiki" target="_blank"><i class="material-icons md-click md-18">help</i></a>
							</div>
						</div>
					</div>

					<form accept-charset="UTF-8">
						<table style="width: 100%;">
							<tr>
								<td class="name" style="width:50%;"><label for="spreadsheet_name">Spreadsheet title</label></td>
								<td><input type="text" id="spreadsheet_name" maxlength="53" required></td>
							</tr>
						</table>
						<table style="width: 100%; margin-top: 2em;">
							<tr>
								<th colspan="2" style="font-size:1.2em;"><i class="material-icons">calendar_today</i> Calendar</th>
							</tr>
							<tr>
								<td class="name" style="width:50%;"><label for="financial_year">Financial year</label></td>
								<td><input type="number" id="financial_year" style="width:61px;" min="1889" max="2111" step="1" required></td>
							</tr>
							<tr>
								<td class="name" style="width:50%;"><label for="initial_month">Initial month</label></td>
								<td>
									<select id="initial_month" style="width:89px;">
										<option value="0" selected>January</option>
										<option value="1">February</option>
										<option value="2">March</option>
										<option value="3">April</option>
										<option value="4">May</option>
										<option value="5">June</option>
										<option value="6">July</option>
										<option value="7">August</option>
										<option value="8">September</option>
										<option value="9">October</option>
										<option value="10">November</option>
										<option value="11">December</option>
									</select>
								</td>
							</tr>
						</table>
						<table style="width: 100%; margin-top: 2em;">
							<tr>
								<th colspan="2" style="font-size:1.2em;"><i class="material-icons">account_balance</i> Accounts</th>
							</tr>
							<tr>
								<td class="name comment" style="width:50%;"><label for="number_accounts">Accounts</label></td>
								<td>
									<select id="number_accounts" style="width:83px;">
										<option value="1" selected>One</option>
										<option value="2">Two</option>
										<option value="3">Three</option>
										<option value="4">Four</option>
										<option value="5">Five</option>
									</select>
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 1</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" class="account_name" style="width: 100%;" required>
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 2</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" class="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 3</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" class="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 4</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" class="account_name" style="width: 100%;">
								</td>
							</tr>
							<tr class="num_acc">
								<td>
									<label style="font-weight: bold;">Account 5</label><br/>
									<span class="gray">Name</span>
								</td>
								<td>
									<input type="text" class="account_name" style="width: 100%;">
								</td>
							</tr>
						</table>
					</form>
				</div>

				<div class="panel" id="setup-panel">
					<div style="width:100%;margin:40px auto;" align="center">
						<h2>Assembling your spreadsheet</h2>
						<br>
						<div class="animation_WaitLoad_wrapper">
							<div class="animation_WaitLoad_bar"></div>
						</div>
						<div style="width:263px;margin-top:30px;">
							This process takes up to two minutes. Do not edit the spreadsheet until it is finished.
						</div>
					</div>
				</div>
			</div>

			<div id="MainPanel_footer" style="display:table;">
				<div style="display:table-row;">
					<div id="footer-buttons" style="height:3.7em;display:table-cell;padding:7px;vertical-align:middle;">
					</div>
				</div>
			</div>
		</div>
		<?!= htmlInclude("htmlJavaScript"); ?>
		<script>
			$(document).ready(function() {
				var date = new Date();
				$("#financial_year").val(date.getFullYear());
				if (date.getMonth() > 1) {
					$("#initial_month").val(date.getMonth() - 1);
				}

				$(".num_acc").slice(1).hide();
				$("#main-panel").fadeIn().addClass("active");
			});

			$("#number_accounts").change(function() {
				var num_acc = Number( $(this).val() );

				$(".num_acc").show();
				$(".num_acc").slice(num_acc).hide();

				$(".account_name").attr("required", true);
				$(".account_name").slice(num_acc).attr("required", false).val("");
			});

			function clickNext() {
				window.scrollTo(0, 0);
				var p = $(".active").attr("id");
				$(".active").hide()
					.removeClass("active")
					.next()
					.fadeIn("fast")
					.addClass("active")
					.siblings()
					.removeClass("active");
				$("#footer-buttons button").remove();

				switch (p) {
					case "main-panel":
						$("#footer-buttons").append("<button class=\"action\" onclick=\"clickNext()\">Continue</button>");
						break;
					case "note-panel":
						$("#footer-buttons").append("<button class=\"create\" onclick=\"clickNext()\">Build</button>");
						break;
					case "form-panel":
						fireSetup();
						break;

					default:
						showError();
						break;
				}
			}

			function fireSetup() {
				var settings = {
					spreadsheet_name: $("#spreadsheet_name").val(),
					financial_year: $("#financial_year").val(),
					initial_month: $("#initial_month").val(),
					number_accounts: $("#number_accounts").val()
				};

				var names = $(".account_name[required]");
				var list_names = names.map(function() {
					return $(this).val();
				}).get();

				google.script.run
					.withSuccessHandler(function() {
							google.script.host.close();
						})
					.withFailureHandler(showError)
					.setup_ui(settings, list_names);
			}
		</script>
	</body>
</html>
