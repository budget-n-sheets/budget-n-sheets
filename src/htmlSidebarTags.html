<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude('htmlStyles'); ?>
		<script src="https://www.gstatic.com/charts/loader.js"></script>
		<script>
			google.charts.load('current', {'packages':['corechart'], 'language': 'en-us'});
		</script>
		<style>
			#tab_book { color: #b4a7d6; }
			#tab_book:hover { color: #9900ff; }
			#tab_book.active { color: #9900ff;border-bottom: solid 2px; }

			#tab_view-list { color: #f9cb9c; }
			#tab_view-list:hover { color: #ff9900; }
			#tab_view-list.active { color: #ff9900;border-bottom: solid 2px; }

			#MainPanel_header {
				height: 3.7em;
				width: 100%;
				background-color: #efefef;
				border-bottom: 2px solid #d9d9d9;
			}

			.MainMenu-top_title {
				display: table;
				width: inherit;
				height: inherit;
				border-collapse: separate;
				border-spacing: 13px 7px;
			}
			.MainMenu-bot_title {
				display: table;
				width: 100%;
				border-collapse: separate;
				border-spacing: 7px;
			}
			.MainMenu_row {
				display: table-row;
			}
			.m-tab {
				cursor: pointer;
				display: table-cell;
				vertical-align:middle;
				color: #7a7a7a;
				font-size: 24px;
			}
			.m-footer {
				display: table-cell;
				vertical-align: middle;
			}

			#p-Book_WaitLoad {
				width: 223px;
				margin: 93px auto;
			}


			.Tags-title {
				font-weight: bold;
				font-size: 19px;
				padding-bottom: 7px;
			}
			.Tags-table {
				display: table;
				width: 100%;
				border-collapse: separate;
				border-spacing: 3px 2px;

				counter-reset: tag-index;
			}
			.Tag-row {
				cursor: pointer;
				display: table-row;
			}
			.Tag-row::before {
				display: table-cell;
				padding: 3px 7px;
				font-weight: bold;
				background-color: #b4a7d6;

				counter-increment: tag-index;
				content: counter(tag-index);
			}
			.Tag-name {
				width: 100%;
				display: table-cell;
				padding: 2px 3px;
				font-weight: bold;
				background-color: #d9d9d9;
			}
			.Tag-name:hover {
				background-color: #efefef;
			}


			table.StdTags-table {
				width: 100%;
				margin-bottom: 13px;
				border-spacing: 3px 2px;
				background-color: #efefef;
			}
			td.StdTags-index {
				padding: 3px 7px;
				font-weight: bold;
				background-color: #f6b26b;
			}
			td.StdTags-name {
				width: 100%;
				padding: 2px 3px;
				font-weight: bold;
				background-color: #d9d9d9;
			}
			td.StdTags-text {
				padding: 2px 3px;
				text-align: justify;
			}
		</style>
	</head>
	<body>
		<div id="MainPanel_wrapper">
			<div class="panel active" id="MainPanel_header" align="center">
				<div class="MainMenu-top_title"><div class="MainMenu_row">
						<div class="m-tab active" id="tab_book">
							<i class="material-icons" title="Custom tags">book</i>
						</div>
						<div class="m-tab" id="tab_view-list">
							<i class="material-icons" title="Standard tags">view_list</i>
						</div>
				</div></div>
			</div>

			<div id="MainPanel_content" style="margin-bottom:2.3em;">
				<div class="panel active" id="panel_Book">
					<div class="panel active" id="p-Book_WaitLoad">
						<div class="animation_WaitLoad_wrapper">
							<div class="animation_WaitLoad_bar"></div>
						</div>
					</div>

					<div class="panel" id="p-Book_ListTags">
						<div id="p-Book_BoxListTags">
						</div>
					</div>
				</div>

				<div class="panel" id="panel_ViewList">
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Withdrawal</td>
							<td class="StdTags-index">#wd</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
								Mark withdrawals from your bank account. For example, from an ATM.
							</td>
						</tr>
					</table>
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Deposit</td>
							<td class="StdTags-index">#dp</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
								Mark deposits to your bank account. It works just like the <b>Transfer #trf</b> tag, but it can be useful to discrimate the banking operations.
							</td>
						</tr>
					</table>
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Transfer</td>
							<td class="StdTags-index">#trf</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
								Mark value transfer to/from your account.<br/>
								<ul>
									<li>If a transfer is <b>to</b> your account, use a <b>positive</b> value as it is being credit to your account.</li>
									<li>If a transfer is <b>from</b> your account, use a <b>negative</b> value as it is flowing out of your account.</li>
								</ul>
							</td>
						</tr>
					</table>
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Income</td>
							<td class="StdTags-index">#rct</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
								Mark your income. The subtotal is displayed in the header of each bank table, and the total is displayed in <b>Summary</b> sheet.
							</td>
						</tr>
					</table>
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Payment of credit card bill</td>
							<td class="StdTags-index">#qcc</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
							</td>
						</tr>
					</table>
					<table class="StdTags-table">
						<tr class="StdTags-row">
							<td class="StdTags-name">Ignore</td>
							<td class="StdTags-index">#ign</td>
						</tr>
						<tr>
							<td class="StdTags-text" colspan="2">
								Mark events which values are to be ignored and not accounted in the total of expenses.
							</td>
						</tr>
					</table>
				</div>

				<div class="panel" id="panel_WaitLoad">
					<div class="animation_WaitLoad_wrapper">
						<div class="animation_WaitLoad_bar"></div>
					</div>
				</div>
			</div>

			<div id="MainPanel_footer">
				<div class="MainMenu-bot_title"><div class="MainMenu_row">
					<div class="m-footer left" style="width:100%;">
					</div>
					<div class="m-footer right">
						<a id="i-help" href="https://github.com/guimspace/budget-n-sheets/wiki" target="_blank"><i class="material-icons md-click md-18" title="Help">help</i></a>
					</div>
				</div></div>
			</div>
		</div>
		<?!= htmlInclude('htmlJavaScript'); ?>
		<script>
			$(document).ready(function() {
				google.script.run.withSuccessHandler(ListTags_Merge)
					.withFailureHandler(showError)
					.optMainTags('GetList');
			});

			$(document).on('click', '.m-tab', function() {
				if ( $(this).hasClass('active') || $(this).attr('id') == '' ) return;

				window.scrollTo(0, 0);
				$(this).addClass('active').siblings().removeClass('active');

				switch ( $(this).attr('id') ) {
					case 'tab_book':
						goBackToPanel('p-Book');
						break;
					case 'tab_view-list':
						goBackToPanel('p-ViewList');
						break;

					default:
						showError();
						break;
				}
			});

			$(document).on('click', '.m-li', function() {
				google.script.run.withFailureHandler(showError)
					.showPanelTagsStats( $(this).attr('id') );
			});

			function goBackToPanel(input) {
				$('.m-tab').removeClass('active');

				switch (input) {
					case 'p-Book':
						$('#tab_book').addClass('active');
						$('#panel_Book').fadeIn('fast').siblings().hide();
						break;
					case 'p-ViewList':
						$('#tab_view-list').addClass('active');
						$('#panel_ViewList').fadeIn('fast').siblings().hide();
						break;
					case 'o-WaitLoad':
						$('#panel_WaitLoad').fadeIn('fast').siblings().hide();
						break;

					default:
						showError();
						break;
				}
			}

			function ListTags_Merge(input) {
				if (input === 0) {
					google.script.run.withFailureHandler(showError)
						.showDialogQuickMessage("", 'The add-on is busy. Try again a moment.', true);
					return;
				} else if (input === 2) {
					showError();
					return;
				}

				var TC_CODE_ = [ "A", "D", "E", "F", "G", "K", "L", "S", "T", "U" ];
				var TC_NAME_ = [ "Food and supply", "Shopping and clothing", "Hobby", "Leisure time", "Home", "Other", "Health and insurance", "Services", "Transport", "Traveling" ];

				var string;
				var i, j;

				$('#p-Book_BoxListTags').empty();

				for (i = 0; i < 10; i++) {
					if (input[i][0] == 0) continue;

					$('#p-Book_BoxListTags').append('<span class="Tags-title">'+TC_NAME_[i]+'</span><div class="Tags-table" id="TagCategory-'+TC_CODE_[i]+'"></div><hr>');

					string = '#TagCategory-'+TC_CODE_[i];
					for (j = 0; j < input[i][0]; j++) {
						$(string).append('<div class="Tag-row m-li" id="'+input[i][j+1].tag+'"><div class="Tag-name">'+input[i][j+1].name+'</div></div>');
					}
				}

				$('#p-Book_ListTags').fadeIn('fast')
					.siblings()
					.hide();
			}
		</script>
	</body>
</html>
