<!DOCTYPE html>
<html>
	<head>
		<base target="_top">
		<meta charset="UTF-8">
		<?!= htmlInclude('htmlStyles'); ?>
		<style>
			.MainMenu-bot_title {
				display: table;
				width: 100%;
				border-collapse: separate;
				border-spacing: 7px;
			}
			.MainMenu_row {
				display: table-row;
			}
			.m-footer {
				display: table-cell;
				vertical-align: middle;
			}
		</style>
		<script src="https://www.gstatic.com/charts/loader.js"></script>
		<script>
			google.charts.load('current', {'packages':['corechart'], 'language': 'en-us'});
		</script>
	</head>
	<body>
		<div id="MainPanel_wrapper">
			<div id="MainPanel_content" style="margin-bottom:4.7em;">
				<h2><?= tag_name ?></h2>
				<table style="width:100%;">
					<tr>
						<td class="name"><label>Code</label></td>
						<td><?= tag_code ?></td>
					</tr>
					<tr>
						<td class="name"><label>Category</label></td>
						<td><?= tag_category ?></td>
					</tr>
					<tr>
						<td class="name"><label>Description</label></td>
						<td style="font-style:italic;"><?= tag_description ?></td>
					</tr>
					<tr>
						<td class="name">Analytics</td>
						<td><?= tag_analytics ?></td>
					</tr>
				</table>

				<table style="width:100%;margin-top:1.7em;">
					<tr>
						<th colspan="2"><span style="font-size:1.2em;">Statistics</span></th>
					</tr>

					<tr>
						<td class="name"><label>Period</label></td>
						<td><span id="tag_interval" style="float:right;"></span></td>
					</tr>
					<tr>
						<td colspan="2">
							<div style="width:100%;margin:0 auto;">
								<div style="padding:0 3px;">
									<span style="font-weight:bold;">MINIMUM</span>
									<span style="float:right;" id="tag_min"></span>
								</div>
								<div style="padding:0 3px;">
									<span style="font-weight:bold;">MAXIMUM</span>
									<span style="float:right;" id="tag_max"></span>
								</div>
								<div style="padding:0 3px;">
									<span style="font-weight:bold;">AVERAGE</span>
									<span style="float:right;" id="tag_average"></span>
								</div>
								<div style="padding:0 3px;">
									<span style="font-weight:bold;">TOTAL</span>
									<span style="float:right;" id="tag_total"></span>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<div id="tag_chart"></div>
						</td>
					</tr>
				</table>
			</div>

			<div id="MainPanel_footer">
				<div class="MainMenu-bot_title"><div class="MainMenu_row">
					<div class="m-footer left"style="width: 100%;">
						<button onclick="google.script.host.close()">Close</button>
					</div>
					<div class="m-footer right">
						<a id="i-help" href="https://forms.gle/sVzBD4345hWh5gYB8" target="_blank"><i class="material-icons md-click md-24" title="Send feedback">feedback</i></a>
					</div>
				</div></div>
			</div>
		</div>

		<?!= htmlInclude('htmlJavaScript'); ?>
		<script>
			$(document).ready(function() {
				google.script.run.withSuccessHandler(printStats)
					.withFailureHandler(showError)
					.optMainTags("GetStat", <?= tag_code ?>);
			});

			function printStats(input) {
				var builder, data, options;

				$('#tag_interval').append(input.Interval);
				$('#tag_total').append(input.Total);
				$('#tag_average').append(input.Average);
				$('#tag_min').append(input.Min);
				$('#tag_max').append(input.Max);

				options = {
					'width':413,
					'height':293,
					'isStacked':true,
					'seriesType':'bars',
					'legend':{ 'position':'none' },
					'theme':'maximized',
					'focusTarget':'category',
					'vAxis':{'format':'#,##0.00;(#,##0.00)'}
				};

				data = new google.visualization.arrayToDataTable(input.Data);

				<? if (is_initiated) { ?>
					options['series'] = { 0:{ color:'#cccccc' }, 1:{ color:'#a4c2f4' }, 2:{ color:'#6d9eeb' }, 3:{ 'type':'line', color:'#e06666' } };
				<? } else { ?>
					options['series'] = { 0:{ color:'#cccccc' }, 1:{ color:'#a4c2f4' } };
					data.removeColumn(4);
					data.removeColumn(3);
				<? } ?>

				builder = new google.visualization.ComboChart( document.getElementById('tag_chart') );
				builder.draw(data, options);
			}
		</script>
	</body>
</html>
