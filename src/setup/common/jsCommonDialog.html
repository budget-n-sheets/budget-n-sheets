<script>
  $(document).on('click', '.add-acc', function() {
    $('#accError').empty();
    if (Glob.num_acc > 4) {
      $('#addAcc').hide();
      $('#accError').append('No slot available.');
      return;
    };

    const key = $(this).attr('id');
    $(this).closest('tr').remove();
    addAccInput(key);
  });

  $(document).on('click', '.remove-acc', function() {
    $('#accError').empty();
    if (Glob.num_acc === 1) return;

    const $tr = $(this).closest('tr');
    const key = $tr.attr('id');
    if (key) deselectAcc(key);

    $tr.remove();
    Glob.num_acc--;

    if (Glob.num_acc < 5) $('#addAcc').show();
    if (Glob.num_acc === 1) $('.remove-acc').css({
      visibility: 'hidden'
    });
  });

  function addAccInput(key) {
    $('#accError').empty();
    if (Glob.num_acc > 4) return;

    const $tr = $('<tr>').attr({
      class: 'num_acc'
    });
    if (key) $tr.attr('id', key);

    let $el = null;

    const $td1 = $('<td>');
    $el = $('<span>').attr({
        class: 'material-icons remove-acc'
      })
      .css({
        visibility: 'hidden',
        cursor: 'pointer',
        'padding-right': '3px'
      })
      .text('remove_circle')
      .appendTo($td1);
    $td1.append($el);


    const $td2 = $('<td>').css({
      width: '100%'
    });
    $el = $('<input>').attr({
        type: 'text',
        name: 'account_name',
        placeholder: 'Name',
        required: true
      })
      .css({
        width: '100%'
      });
    if (key) {
      $el.attr({
        value: Glob.accounts[key].name,
        disabled: true,
        readonly: true
      });
    }
    $td2.append($el);

    const $td3 = $('<td>');
    $('<span>').attr({
        class: 'material-icons handle'
      })
      .css({
        cursor: 'grabbing'
      })
      .text('drag_handle')
      .appendTo($td3);

    $td1.appendTo($tr);
    $td2.appendTo($tr);
    $td3.appendTo($tr);

    $('#accSortable').append($tr);
    Glob.num_acc++;

    if (Glob.num_acc > 4) $('#addAcc').hide();
    if (Glob.num_acc > 1) $('.remove-acc').css({
      visibility: 'visible'
    });

    if (!key) $tr.find('input').focus();
  }

  function deselectAcc(key) {
    const $tr = $('<tr>');

    const $td1 = $('<td>');
    $('<span>').attr({
        class: 'material-icons add-acc',
        id: key
      })
      .css({
        cursor: 'pointer'
      })
      .text('add_circle')
      .appendTo($td1);

    const $td2 = $('<td>').css({
      width: '100%'
    });
    $('<input>').attr({
        type: 'text',
        value: Glob.accounts[key].name,
        disabled: true,
        readonly: true
      })
      .css({
        width: '100%'
      })
      .appendTo($td2);

    $td1.appendTo($tr);
    $td2.appendTo($tr);

    $('#accRemoved').append($tr);
  }
</script>
