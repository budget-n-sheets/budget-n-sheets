<script>
  $(document).ready(function() {
    $('#panel-accounts').show();
    google.script.run
      .withSuccessHandler(listAccounts)
      .withFailureHandler(showError)
      .accountsClientService({ job: 'list' });
  });

  $(document).on('click', '.a-edit', function(e) {
    google.script.run
      .withSuccessHandler(responseHandler)
      .withFailureHandler(showError)
      .showDialogEditAccount($(this).parent().attr('id'));
  });

  function listAccounts (db_accounts) {
    const $box = $('#panel-accounts');

    for (const id in db_accounts) {
      const $text = $('<div>').attr({class: 'text'}).append(db_accounts[id].name);
      const $icons = $('<div>').attr({class: 'md-box', id: id}).append([
        $('<span>').attr({class: 'a-edit material-icons md-18'}).text('edit')
      ]);

      $box.append($('<div>')
        .attr({class: 'item'})
        .css({'background-color': db_accounts[id].color})
        .append([$text, $icons]));
    }

    $('#panel-accounts > div:not(:first-child)').before('<hr>');
  }
</script>
